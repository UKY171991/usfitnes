<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PathLab Pro - System Status</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-microscope mr-2"></i>
                            PathLab Pro - System Status Check
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-database mr-2"></i>Database Connection</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="dbStatus">
                                            <i class="fas fa-spinner fa-spin"></i> Checking...
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-cog mr-2"></i>API Status</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="apiStatus">
                                            <i class="fas fa-spinner fa-spin"></i> Checking...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>Quick Actions:</h5>
                            <div class="btn-group" role="group">
                                <a href="patients.php" class="btn btn-primary">
                                    <i class="fas fa-user-injured mr-2"></i>Go to Patients
                                </a>
                                <a href="dashboard.php" class="btn btn-info">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                                </a>
                                <button class="btn btn-success" onclick="recheckStatus()">
                                    <i class="fas fa-sync-alt mr-2"></i>Recheck Status
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle mr-2"></i>Demo Mode Information:</h6>
                                <p class="mb-0">
                                    If the database connection fails, the system will automatically switch to demo mode 
                                    with sample data. All functionality will work, but changes won't be saved permanently.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <script>
    $(document).ready(function() {
        checkSystemStatus();
    });

    function checkSystemStatus() {
        // Check database connection
        checkDatabase();
        
        // Check API
        checkAPI();
    }

    function checkDatabase() {
        $.ajax({
            url: 'check_patients_table.php',
            method: 'GET',
            timeout: 5000,
            success: function(response) {
                $('#dbStatus').html('<i class="fas fa-check-circle text-success"></i> Database Connected');
                toastr.success('Database connection successful');
            },
            error: function(xhr, status, error) {
                $('#dbStatus').html('<i class="fas fa-times-circle text-danger"></i> Database Unavailable<br><small class="text-muted">Demo mode will be used</small>');
                toastr.warning('Database connection failed - Demo mode active');
            }
        });
    }

    function checkAPI() {
        $.ajax({
            url: 'api/patients_api.php',
            method: 'GET',
            data: { action: 'stats' },
            timeout: 5000,
            success: function(response) {
                if (response.success) {
                    $('#apiStatus').html('<i class="fas fa-check-circle text-success"></i> API Working');
                    toastr.success('API is functioning correctly');
                } else {
                    $('#apiStatus').html('<i class="fas fa-exclamation-triangle text-warning"></i> API Issues<br><small class="text-muted">Demo data will be used</small>');
                    toastr.warning('API has issues - Using demo data');
                }
            },
            error: function(xhr, status, error) {
                $('#apiStatus').html('<i class="fas fa-times-circle text-danger"></i> API Unavailable<br><small class="text-muted">Demo mode will be used</small>');
                toastr.warning('API connection failed - Demo mode active');
            }
        });
    }

    function recheckStatus() {
        $('#dbStatus').html('<i class="fas fa-spinner fa-spin"></i> Checking...');
        $('#apiStatus').html('<i class="fas fa-spinner fa-spin"></i> Checking...');
        checkSystemStatus();
    }
    </script>
</body>
</html>
