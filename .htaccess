# PathLab Pro - Security Configuration
# Protect sensitive files and directories

# Deny access to configuration files
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

# Protect database setup and maintenance files
<FilesMatch "(fix_database_schema|quick_fix|status_check|database_setup|cleanup)\.php$">
    Order Allow,Deny
    Deny from all
    # Allow only from localhost for development
    Allow from 127.0.0.1
    Allow from ::1
</FilesMatch>

# Protect backup files
<FilesMatch "\.(sql|bak|backup|log)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Protect sensitive directories
<Directory "admin">
    Order Allow,Deny
    Deny from all
    # Allow only authenticated admin users
    AuthType Basic
    AuthName "Administrator Area"
    AuthUserFile /path/to/.htpasswd
    Require valid-user
</Directory>

# Protect includes directory from direct access
<Directory "includes">
    Order Allow,Deny
    Deny from all
</Directory>

# Protect API directory from unauthorized access
<Directory "api">
    # Allow API access but log requests
    Order Allow,Deny
    Allow from all
    
    # Rate limiting (if mod_evasive is available)
    <IfModule mod_evasive24.c>
        DOSHashTableSize    2048
        DOSPageCount        10
        DOSSiteCount        50
        DOSPageInterval     1
        DOSSiteInterval     1
        DOSBlockingPeriod   600
    </IfModule>
</Directory>

# Security headers
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always append X-Frame-Options SAMEORIGIN
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options nosniff
    
    # Enable XSS protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Content Security Policy (adjust as needed)
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://cdn.datatables.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdn.datatables.net; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self';"
</IfModule>

# Disable server signature
ServerSignature Off

# Hide Apache version
<IfModule mod_headers.c>
    Header unset Server
    Header always unset X-Powered-By
</IfModule>

# Prevent access to version control files
<FilesMatch "^\.">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Prevent access to sensitive file types
<FilesMatch "\.(env|ini|conf|config|bak|backup|swp|tmp)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Custom error pages
ErrorDocument 403 /error_pages/403.html
ErrorDocument 404 /error_pages/404.html
ErrorDocument 500 /error_pages/500.html

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/ico "access plus 1 month"
    ExpiresByType image/icon "access plus 1 month"
    ExpiresByType text/x-icon "access plus 1 month"
    ExpiresByType application/x-icon "access plus 1 month"
</IfModule>